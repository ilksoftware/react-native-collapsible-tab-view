{"version":3,"sources":["TabBar.tsx"],"names":["React","StyleSheet","useWindowDimensions","Animated","cancelAnimation","scrollTo","useAnimatedReaction","useAnimatedRef","useAnimatedScrollHandler","useSharedValue","withTiming","Indicator","MaterialTabItem","TABBAR_HEIGHT","MaterialTabBar","tabNames","indexDecimal","scrollEnabled","indicatorStyle","index","TabItemComponent","getLabelText","name","String","toUpperCase","onTabPress","style","tabProps","contentContainerStyle","labelStyle","inactiveColor","activeColor","tabStyle","tabBarRef","windowWidth","width","isFirstRender","useRef","itemsLayoutGathering","setItemsLayoutGathering","useState","Map","tabBarWidth","setTabBarWidth","tabsOffset","isScrolling","nTabs","length","itemsLayout","setItemsLayout","map","_","i","tabWidth","x","useEffect","current","onTabItemLayout","useCallback","event","nativeEvent","layout","update","set","onLayout","Array","from","entries","filter","tabName","includes","sort","a","b","cancelNextScrollSync","value","onScroll","contentOffset","onBeginDrag","onMomentumEnd","currentIndexToSync","targetIndexToSync","nextIndex","canSync","halfTab","offset","styles","contentContainer","undefined","get","label","MemoizedTabBar","memo","create","flexDirection","flexWrap"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {\n  StyleSheet,\n  useWindowDimensions,\n  LayoutChangeEvent,\n} from 'react-native'\nimport Animated, {\n  cancelAnimation,\n  scrollTo,\n  useAnimatedReaction,\n  useAnimatedRef,\n  useAnimatedScrollHandler,\n  useSharedValue,\n  withTiming,\n} from 'react-native-reanimated'\n\nimport { TabName } from '../types'\nimport { Indicator } from './Indicator'\nimport { MaterialTabItem } from './TabItem'\nimport { MaterialTabBarProps, ItemLayout } from './types'\n\nexport const TABBAR_HEIGHT = 48\n\n/**\n * Basic usage looks like this:\n *\n * ```tsx\n * <Tabs.Container\n *   ...\n *   TabBarComponent={(props) => (\n *     <MaterialTabBar\n *       {...props}\n *       activeColor=\"red\"\n *       inactiveColor=\"yellow\"\n *       inactiveOpacity={1}\n *       labelStyle={{ fontSize: 14 }}\n *     />\n *   )}\n * >\n *   {...}\n * </Tabs.Container>\n * ```\n */\nconst MaterialTabBar = <T extends TabName = any>({\n  tabNames,\n  indexDecimal,\n  scrollEnabled = false,\n  indicatorStyle,\n  index,\n  TabItemComponent = MaterialTabItem,\n  getLabelText = (name) => String(name).toUpperCase(),\n  onTabPress,\n  style,\n  tabProps,\n  contentContainerStyle,\n  labelStyle,\n  inactiveColor,\n  activeColor,\n  tabStyle,\n}: MaterialTabBarProps<T>): React.ReactElement => {\n  const tabBarRef = useAnimatedRef<Animated.ScrollView>()\n  const windowWidth = useWindowDimensions().width\n  const isFirstRender = React.useRef(true)\n  const [itemsLayoutGathering, setItemsLayoutGathering] = React.useState(\n    new Map<T, ItemLayout>()\n  )\n  const [tabBarWidth, setTabBarWidth] = React.useState<number>(windowWidth)\n  const tabsOffset = useSharedValue(0)\n  const isScrolling = useSharedValue(false)\n\n  const nTabs = tabNames.length\n\n  const [itemsLayout, setItemsLayout] = React.useState<ItemLayout[]>(\n    scrollEnabled\n      ? []\n      : tabNames.map((_, i) => {\n          const tabWidth = tabBarWidth / nTabs\n          return { width: tabWidth, x: i * tabWidth }\n        })\n  )\n\n  React.useEffect(() => {\n    if (isFirstRender.current) {\n      isFirstRender.current = false\n    } else if (!scrollEnabled) {\n      // update items width on window resizing\n      const tabWidth = tabBarWidth / nTabs\n      setItemsLayout(\n        tabNames.map((_, i) => {\n          return { width: tabWidth, x: i * tabWidth }\n        })\n      )\n    }\n  }, [scrollEnabled, nTabs, tabNames, tabBarWidth])\n\n  const onTabItemLayout = React.useCallback(\n    (event: LayoutChangeEvent, name: T) => {\n      if (scrollEnabled) {\n        if (!event.nativeEvent?.layout) return\n        const { width, x } = event.nativeEvent.layout\n        setItemsLayoutGathering((itemsLayoutGathering) => {\n          const update = new Map(itemsLayoutGathering)\n          return update.set(name, {\n            width,\n            x,\n          })\n        })\n      }\n    },\n    [scrollEnabled]\n  )\n\n  const onLayout = React.useCallback(\n    (event: LayoutChangeEvent) => {\n      const width = event.nativeEvent.layout.width\n      if (tabBarWidth !== width) setTabBarWidth(width)\n    },\n    [tabBarWidth]\n  )\n\n  React.useEffect(() => {\n    // pick out the layouts for the tabs we know about (in case they changed dynamically)\n    const layout = Array.from(itemsLayoutGathering.entries())\n      .filter(([tabName]) => tabNames.includes(tabName))\n      .map(([, layout]) => layout)\n      .sort((a, b) => a.x - b.x)\n\n    if (layout.length === tabNames.length) {\n      setItemsLayout(layout)\n    }\n  }, [itemsLayoutGathering, tabNames])\n\n  const cancelNextScrollSync = useSharedValue(index.value)\n\n  const onScroll = useAnimatedScrollHandler(\n    {\n      onScroll: (event) => {\n        tabsOffset.value = event.contentOffset.x\n      },\n      onBeginDrag: () => {\n        isScrolling.value = true\n        cancelNextScrollSync.value = index.value\n      },\n      onMomentumEnd: () => {\n        isScrolling.value = false\n      },\n    },\n    []\n  )\n\n  const currentIndexToSync = useSharedValue(index.value)\n  const targetIndexToSync = useSharedValue(index.value)\n\n  useAnimatedReaction(\n    () => {\n      return index.value\n    },\n    (nextIndex) => {\n      if (scrollEnabled) {\n        cancelAnimation(currentIndexToSync)\n        targetIndexToSync.value = nextIndex\n        currentIndexToSync.value = withTiming(nextIndex)\n      }\n    },\n    [scrollEnabled]\n  )\n\n  useAnimatedReaction(\n    () => {\n      return currentIndexToSync.value === targetIndexToSync.value\n    },\n    (canSync) => {\n      if (\n        canSync &&\n        scrollEnabled &&\n        itemsLayout.length === nTabs &&\n        itemsLayout[index.value]\n      ) {\n        const halfTab = itemsLayout[index.value].width / 2\n        const offset = itemsLayout[index.value].x\n        if (\n          offset < tabsOffset.value ||\n          offset > tabsOffset.value + tabBarWidth - 2 * halfTab\n        ) {\n          scrollTo(tabBarRef, offset - tabBarWidth / 2 + halfTab, 0, true)\n        }\n      }\n    },\n    [scrollEnabled, itemsLayout, nTabs]\n  )\n  return (\n    <Animated.ScrollView\n      ref={tabBarRef}\n      horizontal\n      style={style}\n      contentContainerStyle={[\n        styles.contentContainer,\n        !scrollEnabled && { width: tabBarWidth },\n        contentContainerStyle,\n      ]}\n      keyboardShouldPersistTaps=\"handled\"\n      bounces={false}\n      alwaysBounceHorizontal={false}\n      scrollsToTop={false}\n      showsHorizontalScrollIndicator={false}\n      automaticallyAdjustContentInsets={false}\n      overScrollMode=\"never\"\n      scrollEnabled={scrollEnabled}\n      onScroll={scrollEnabled ? onScroll : undefined}\n      scrollEventThrottle={16}\n      onLayout={onLayout}\n    >\n      {tabNames.map((name, i) => {\n        return (\n          <TabItemComponent\n            key={name}\n            index={i}\n            name={name}\n            label={tabProps.get(name)?.label || getLabelText(name)}\n            onPress={onTabPress}\n            onLayout={\n              scrollEnabled\n                ? (event) => onTabItemLayout(event, name)\n                : undefined\n            }\n            scrollEnabled={scrollEnabled}\n            indexDecimal={indexDecimal}\n            labelStyle={labelStyle}\n            activeColor={activeColor}\n            inactiveColor={inactiveColor}\n            style={tabStyle}\n          />\n        )\n      })}\n      {itemsLayout.length === nTabs && (\n        <Indicator\n          indexDecimal={indexDecimal}\n          itemsLayout={itemsLayout}\n          fadeIn={scrollEnabled}\n          style={indicatorStyle}\n        />\n      )}\n    </Animated.ScrollView>\n  )\n}\n\nconst MemoizedTabBar = React.memo(MaterialTabBar)\n\nexport { MemoizedTabBar as MaterialTabBar }\n\nconst styles = StyleSheet.create({\n  contentContainer: {\n    flexDirection: 'row',\n    flexWrap: 'nowrap',\n  },\n})\n"]}